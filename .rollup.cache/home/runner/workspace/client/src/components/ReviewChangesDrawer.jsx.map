{"version":3,"file":"ReviewChangesDrawer.jsx","sourceRoot":"","sources":["ReviewChangesDrawer.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport { X, FileText, Upload } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useChangeMode } from \"@/contexts/ChangeModeContext\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface ReviewChangesDrawerProps {\n  isOpen: boolean;\n  onClose: () => void;\n  targetType: string;\n  targetId: string;\n}\n\nexport const ReviewChangesDrawer: React.FC<ReviewChangesDrawerProps> = ({\n  isOpen,\n  onClose,\n  targetType,\n  targetId\n}) => {\n  const { getDiffs, changeRequestTitle, changeRequestCategory, originalSnapshot, reset } = useChangeMode();\n  const [reason, setReason] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  const diffs = getDiffs();\n  \n  // Group diffs by section\n  const groupedDiffs = diffs.reduce((acc, diff) => {\n    const section = diff.path.split('.')[0] || 'General';\n    if (!acc[section]) acc[section] = [];\n    acc[section].push(diff);\n    return acc;\n  }, {} as Record<string, typeof diffs>);\n  \n  const handleSubmit = async (status: 'draft' | 'submitted') => {\n    if (!reason && status === 'submitted') {\n      toast({\n        title: \"Reason required\",\n        description: \"Please provide a reason for this change request\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    setIsSubmitting(true);\n    try {\n      const response = await apiRequest('POST', '/api/change-requests', {\n        title: changeRequestTitle || 'Untitled Change Request',\n        category: changeRequestCategory || targetType,\n        targetType,\n        targetId,\n        status,\n        reason,\n        diffs: diffs.map(d => ({\n          field_path: d.path,\n          old_value: d.oldVal,\n          new_value: d.newVal\n        })),\n        originalSnapshot\n      });\n      \n      if (response.ok) {\n        toast({\n          title: status === 'submitted' ? \"Change request submitted\" : \"Draft saved\",\n          description: status === 'submitted' \n            ? \"Your change request has been submitted for approval\"\n            : \"Your change request has been saved as draft\"\n        });\n        \n        // Reset and navigate back\n        reset();\n        setLocation(\"/pms/modify-pms\");\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to submit change request\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n  \n  if (!isOpen) return null;\n  \n  return (\n    <div className=\"fixed inset-0 z-50 flex\">\n      {/* Backdrop */}\n      <div className=\"flex-1 bg-black/50\" onClick={onClose} />\n      \n      {/* Drawer */}\n      <div className=\"w-[500px] bg-white shadow-xl flex flex-col\">\n        {/* Header */}\n        <div className=\"px-6 py-4 border-b\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-lg font-semibold\">Review Changes</h2>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onClose}\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n        \n        {/* Content */}\n        <ScrollArea className=\"flex-1 px-6 py-4\">\n          {/* Summary */}\n          <div className=\"mb-6\">\n            <h3 className=\"text-sm font-semibold mb-2\">Change Summary</h3>\n            <p className=\"text-sm text-gray-600\">\n              {diffs.length} field{diffs.length !== 1 ? 's' : ''} modified\n            </p>\n          </div>\n          \n          {/* Diffs grouped by section */}\n          <div className=\"space-y-6\">\n            {Object.entries(groupedDiffs).map(([section, sectionDiffs]) => (\n              <div key={section}>\n                <h4 className=\"text-sm font-semibold mb-3\">{section}</h4>\n                <div className=\"space-y-3\">\n                  {sectionDiffs.map((diff, index) => (\n                    <div key={index} className=\"bg-gray-50 rounded-lg p-3\">\n                      <div className=\"text-xs font-medium text-gray-700 mb-1\">\n                        {diff.path.split('.').pop()}\n                      </div>\n                      <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                        <div>\n                          <span className=\"text-xs text-gray-500\">Was:</span>\n                          <div className=\"text-red-600\">{String(diff.oldVal) || '-'}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-xs text-gray-500\">New:</span>\n                          <div className=\"text-green-600\">{String(diff.newVal) || '-'}</div>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            ))}\n          </div>\n          \n          {/* Reason for Change */}\n          <div className=\"mt-6\">\n            <Label htmlFor=\"reason\" className=\"required\">\n              Reason for Change\n            </Label>\n            <Textarea\n              id=\"reason\"\n              value={reason}\n              onChange={(e) => setReason(e.target.value)}\n              placeholder=\"Explain why this change is necessary...\"\n              rows={4}\n              className=\"mt-2\"\n            />\n          </div>\n          \n          {/* File Upload (optional) */}\n          <div className=\"mt-6\">\n            <Label>Evidence/Documentation (Optional)</Label>\n            <div className=\"mt-2 border-2 border-dashed border-gray-300 rounded-lg p-4 text-center\">\n              <Upload className=\"h-8 w-8 mx-auto text-gray-400 mb-2\" />\n              <p className=\"text-sm text-gray-600\">\n                Drag and drop files here, or click to browse\n              </p>\n            </div>\n          </div>\n        </ScrollArea>\n        \n        {/* Footer */}\n        <div className=\"px-6 py-4 border-t\">\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={onClose}\n              disabled={isSubmitting}\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => handleSubmit('draft')}\n              disabled={isSubmitting}\n            >\n              Save Draft\n            </Button>\n            <Button\n              onClick={() => handleSubmit('submitted')}\n              disabled={isSubmitting || !reason}\n            >\n              Submit for Approval\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};"]}